<%= render 'shared/back_header', title: 'Edit Event', back_path: event_post_path(@event_post), back_text: 'Back to Event' %>

<main class="max-w-3xl mx-auto px-4 py-12">
  <div class="mb-8">
    <h2 class="text-3xl text-white font-bold mb-2">Edit Event</h2>
    <p class="text-cyber-grey border-l-4 border-cyber-lime pl-4">Update your event details</p>
  </div>

  <%# Form Card %>
  <div class="relative">
    <div class="absolute inset-0 bg-black skew-card translate-x-2 translate-y-2"></div>
    <div class="relative bg-cyber-card border-2 border-black p-8">
      <%= form_with(model: @event_post, local: true, class: "space-y-8") do |form| %>
        <%# Error Messages %>
        <% if @event_post.errors.any? %>
          <div class="bg-cyber-crimson/20 border-2 border-cyber-crimson p-4 mb-6">
            <p class="text-cyber-crimson font-bold text-sm mb-2">
              <%= pluralize(@event_post.errors.count, "error") %> prohibited this event from being saved:
            </p>
            <ul class="text-cyber-crimson text-sm space-y-1">
              <% @event_post.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <%# Basic Information %>
        <div>
          <h3 class="text-lg text-cyber-lime font-bold mb-4">Basic Information</h3>
          <div class="space-y-4">
            <div>
              <%= form.label :name, class: "block text-cyber-grey text-sm font-bold mb-2" do %>
                Event Name <span class="text-cyber-crimson">*</span>
              <% end %>
              <%= form.text_field :name,
                  class: "w-full bg-cyber-bg border-2 border-cyber-grey text-white px-4 py-3 focus:border-cyber-lime focus:outline-none transition-colors",
                  placeholder: "Enter event name",
                  required: true %>
            </div>

            <div>
              <%= form.label :description, class: "block text-cyber-grey text-sm font-bold mb-2" %>
              <%= form.text_area :description,
                  rows: 4,
                  class: "w-full bg-cyber-bg border-2 border-cyber-grey text-white px-4 py-3 focus:border-cyber-lime focus:outline-none transition-colors",
                  placeholder: "Describe your event..." %>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <%= form.label :event_category_id, class: "block text-cyber-grey text-sm font-bold mb-2" do %>
                  Category <span class="text-cyber-crimson">*</span>
                <% end %>
                <%= form.collection_select :event_category_id, @event_categories, :id, :name,
                    { prompt: "Select category" },
                    { class: "w-full bg-cyber-bg border-2 border-cyber-grey text-white px-4 py-3 focus:border-cyber-lime focus:outline-none transition-colors", required: true } %>
              </div>

              <div>
                <%= form.label :event_time, class: "block text-cyber-grey text-sm font-bold mb-2" do %>
                  Date & Time <span class="text-cyber-crimson">*</span>
                <% end %>
                <%= form.datetime_local_field :event_time,
                    class: "w-full bg-cyber-bg border-2 border-cyber-grey text-white px-4 py-3 focus:border-cyber-lime focus:outline-none transition-colors",
                    required: true %>
              </div>
            </div>
          </div>
        </div>

        <%# Location Details %>
        <div>
          <h3 class="text-lg text-cyber-lime font-bold mb-4">Location</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <%= form.label :location_name, class: "block text-cyber-grey text-sm font-bold mb-2" do %>
                Location <span class="text-cyber-crimson">*</span>
              <% end %>
              <%= form.text_field :location_name,
                  class: "w-full bg-cyber-bg border-2 border-cyber-grey text-white px-4 py-3 focus:border-cyber-lime focus:outline-none transition-colors",
                  placeholder: "e.g., Athletic Complex",
                  required: true %>
            </div>

            <div>
              <%= form.label :capacity, class: "block text-cyber-grey text-sm font-bold mb-2" do %>
                Capacity <span class="text-cyber-crimson">*</span>
              <% end %>
              <%= form.number_field :capacity,
                  min: 1,
                  class: "w-full bg-cyber-bg border-2 border-cyber-grey text-white px-4 py-3 focus:border-cyber-lime focus:outline-none transition-colors",
                  placeholder: "Maximum attendees",
                  required: true %>
            </div>

            <div class="md:col-span-2">
              <%= form.label :google_maps_url, "Google Maps Link (Optional)", class: "block text-cyber-grey text-sm font-bold mb-2" %>
              <%= form.url_field :google_maps_url,
                  class: "w-full bg-cyber-bg border-2 border-cyber-grey text-white px-4 py-3 focus:border-cyber-lime focus:outline-none transition-colors",
                  placeholder: "https://maps.google.com/..." %>
            </div>
          </div>
        </div>

        <%# Registration Settings %>
        <div>
          <h3 class="text-lg text-cyber-lime font-bold mb-4">Registration Settings</h3>
          <div class="bg-purple-900/30 border-2 border-purple-500 p-4">
            <label class="flex items-start gap-3 cursor-pointer">
              <%= form.check_box :requires_approval, class: "mt-1 h-5 w-5 accent-purple-500" %>
              <div>
                <span class="text-purple-400 font-bold text-sm">Require Approval for Registrations</span>
                <p class="text-purple-400/70 text-sm mt-1">
                  When enabled, you must manually approve each registration. Participants will be notified when their registration is approved. Leave unchecked for automatic confirmation.
                </p>
              </div>
            </label>
          </div>
        </div>

        <%# Action Buttons %>
        <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-white/10">
          <%= form.submit "Update Event",
              class: "skew-btn bg-cyber-lime text-black px-8 py-4 font-bold text-lg shadow-[5px_5px_0px_black] hover:shadow-[7px_7px_0px_black] hover:-translate-x-0.5 hover:-translate-y-0.5 transition-all cursor-pointer" %>
          <%= link_to "Cancel", event_post_path(@event_post),
              class: "skew-btn bg-cyber-grey text-black px-6 py-4 font-bold text-center hover:bg-white transition-colors" %>
        </div>
      <% end %>
    </div>
  </div>

  <%# Danger Zone %>
  <div class="mt-12">
    <div class="bg-cyber-crimson/10 border-2 border-cyber-crimson p-6">
      <h3 class="text-lg text-cyber-crimson font-bold mb-4">Danger Zone</h3>
      <p class="text-cyber-grey text-sm mb-4">Deleting this event is permanent and cannot be undone.</p>
      <%= button_to "Delete Event", event_post_path(@event_post),
          method: :delete,
          class: "skew-btn bg-cyber-crimson text-white px-6 py-3 font-bold hover:bg-red-400 transition-colors cursor-pointer",
          data: { confirm: "Are you sure you want to delete this event? This action cannot be undone." } %>
    </div>
  </div>
</main>

<footer class="text-center text-cyber-grey py-10 border-t border-cyber-grey/30 text-sm mt-12">
  SYSTEM STATUS: ONLINE /// e_ren SPACE Â© <%= Time.current.year %>
</footer>
